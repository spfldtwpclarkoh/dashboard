<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Tasks Board</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <style>
        /* Simple fade-in animation for task cards */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .task-card {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 dark:text-gray-200 font-sans antialiased">

    <div class="p-4 md:p-8">
        
        <!-- Header -->
        <header class="p-6 mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-lg">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 dark:text-gray-100">Daily Tasks</h1>
            <p id="current-day" class="text-2xl text-blue-600 dark:text-blue-400 font-semibold mt-1"></p>
        </header>

        <!-- Task Board -->
        <div id="task-board" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6">
            <!-- Tasks will be dynamically inserted here -->
        </div>

        <!-- Loading / No Tasks Message -->
        <div id="message-container" class="text-center p-10">
            <p id="message" class="text-xl text-gray-500 dark:text-gray-400">Loading tasks...</p>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dataUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSgaVOwKFXoya_LyGOX5_CGFkWKw56X6huBFo_t84Sc_UEByoyHdhb3RcfLcIyWHYAlLXdRGNRrf_1B/pub?gid=631251253&single=true&output=csv';
            
            const taskBoard = document.getElementById('task-board');
            const messageEl = document.getElementById('message');
            const currentDayEl = document.getElementById('current-day');

            /**
             * Gets the current day of the week as a string.
             * @returns {string} The full name of the current day (e.g., "Monday").
             */
            function getCurrentDay() {
                const days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
                const today = new Date();
                return days[today.getDay()];
            }

            /**
             * Parses raw CSV text into an array of task objects.
             * Assumes a simple CSV structure.
             * @param {string} csvText - The raw CSV data as a string.
             * @returns {Array<Object>} An array of task objects.
             */
            function parseCSV(csvText) {
                const lines = csvText.trim().split(/\r\n|\n/);
                
                // Handle potential empty input
                if (lines.length < 2) return [];

                // Extract headers and find column indices
                const headers = lines[0].split(',').map(h => h.trim());
                const taskIndex = headers.indexOf("Task");
                const assigneeIndex = headers.indexOf("Assignee");
                const dayIndex = headers.indexOf("Day to appear");

                // Check if all required headers are present
                if (taskIndex === -1 || assigneeIndex === -1 || dayIndex === -1) {
                    console.error("CSV headers are incorrect. Expected 'Task', 'Assignee', 'Day to appear'.");
                    return [];
                }

                const tasks = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',').map(v => v.trim());
                    if (values.length === headers.length) {
                        const task = {
                            Task: values[taskIndex],
                            Assignee: values[assigneeIndex],
                            DayToAppear: values[dayIndex]
                        };
                        tasks.push(task);
                    }
                }
                return tasks;
            }

            /**
             * Creates and appends a task card to the board.
             * @param {Object} task - The task object to display.
             */
            function createTaskCard(task) {
                const card = document.createElement('div');
                card.className = 'task-card bg-white dark:bg-gray-800 p-5 rounded-lg shadow-md border-l-4 border-blue-500';
                
                card.innerHTML = `
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">${task.Task}</h3>
                    <p class="text-lg text-gray-700 dark:text-gray-300">
                        Assigned to: <span class="font-semibold text-blue-700 dark:text-blue-400">${task.Assignee}</span>
                    </p>
                `;
                
                taskBoard.appendChild(card);
            }

            /**
             * Main function to fetch, parse, and display tasks.
             */
            async function loadTasks() {
                const today = getCurrentDay();
                currentDayEl.textContent = `Tasks for ${today}`;

                try {
                    const response = await fetch(dataUrl);
                    if (!response.ok) {
                        throw new Error(`Network response was not ok: ${response.statusText}`);
                    }
                    
                    const csvText = await response.text();
                    const allTasks = parseCSV(csvText);

                    if (allTasks.length === 0 && csvText.length > 0) {
                         messageEl.textContent = "Could not parse tasks. Please check CSV format.";
                         return;
                    }
                    
                    const todayTasks = allTasks.filter(task => 
                        task.DayToAppear.toLowerCase() === today.toLowerCase()
                    );

                    // Clear loading message
                    messageEl.parentElement.style.display = 'none';

                    if (todayTasks.length === 0) {
                        // Show "no tasks" message if board is empty
                        messageEl.textContent = "No tasks for today. Enjoy your day!";
                        messageEl.parentElement.style.display = 'block';
                    } else {
                        // Display each task
                        todayTasks.forEach(createTaskCard);
                    }

                } catch (error)
 {
                    console.error('Failed to load tasks:', error);
                    messageEl.textContent = 'Failed to load tasks. Please check the console for details.';
                    messageEl.classList.add('text-red-500', 'dark:text-red-400');
                }
            }

            // Run the app
            loadTasks();
        });
    </script>
</body>
</html>

